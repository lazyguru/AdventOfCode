#!/bin/bash
YEAR=2021
DAY=$1
PART=$2
WAIT=$3
MYDIR="$HOME/code/AdventOfCode"
USE_CODE=go
MYEDITOR=code
if [ -z "$DAY" ]; then
    DAY=$(TZ=America/New_York date +%d)
fi
if [ -z "$PART" ]; then
    PART=1
fi
if [ -n "$WAIT" ]; then
    WAIT="-wait"
fi
# Get aocdl from https://github.com/GreenLightning/advent-of-code-downloader
DOWNLOAD_SCRIPT="$HOME/go/bin/aocdl -year $YEAR -day $DAY $WAIT"
if [ ! -d "$MYDIR/$YEAR/$DAY" ]; then
    mkdir -p "$MYDIR/$YEAR/$DAY"
fi
cd $MYDIR/utils || exit 1
if [ ! -e venv ]; then
    python3 -m venv venv
    source venv/bin/activate
    pip3 install -r requirements.txt
else
    source venv/bin/activate
fi
python scrape.py -y "$YEAR" -d "$DAY" -o "../$YEAR/$DAY/puzzle.txt"
deactivate
cd "$MYDIR/$YEAR/$DAY" || exit 1
if [ "$USE_CODE" == "py" ]; then
    if [ ! -e part1.py ]; then
        cp -R ../template/*.py ./
    fi
elif [ "$USE_CODE" == "go" ]; then
    if [ ! -e part1.go ]; then
        go mod init "github.com/lazyguru/AdventOfCode/$YEAR/$DAY"
        cp -R ../template/*.go ./
    fi
fi
if [ "$MYEDITOR" == "nvim" ]; then
    tmux new -d -s "aoc$YEAR$DAY" -x "$(tput cols)" -y "$(tput lines)" "$AOC_SESSION $DOWNLOAD_SCRIPT nvim input.txt"
    tmux split-window -t "aoc$YEAR$DAY" -h -p 80
    tmux split-window -t "aoc$YEAR$DAY" -bp 70 nvim -p puzzle.txt part$PART.$USE_CODE
    tmux attach -t "aoc$YEAR$DAY"
else
    $DOWNLOAD_SCRIPT
    $MYEDITOR .
fi
